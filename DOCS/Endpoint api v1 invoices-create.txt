Endpoint: api/v1/invoices
Ruta:

Route::apiResource('invoices', InvoicesController::class);

Descripción:

Este endpoint, en su versión POST, permite crear o actualizar facturas en el sistema.

•  Creación de facturas: Al enviar una solicitud POST con los datos necesarios, el sistema generará una nueva factura. Esto incluye asignar un número de factura único y secuencial, así como aplicar el prefijo correspondiente.

•  Actualización de facturas: Si se proporciona el identificador de una factura existente, el sistema actualizará los datos de dicha factura con la información proporcionada en la solicitud.

Parámetros de Entrada:

•  avalara_bool: Valor booleano (true o false). Indica si la factura es obligatoria para Avalara. Para POS, enviar false.

•  banType: Valor booleano (true o false). Indica si la factura es especial. Obligatorio. Para POS, enviar true.

•  cash_register_id: Valor por defecto null. En este campo se envía el ID de la caja registradora en curso en el POS. Obligatorio si es para POS.

•  contact: Valor por defecto null. Campo de tipo objeto y opcional. Se envía la información de contactos que tienen los siguientes campos:

•  name: Nombre.

•  email: Correo electrónico.

•  identification: Documento de identificación.

•  last_name: Apellido.

•  phone: Número de teléfono.

•  second_phone: Teléfono secundario.

•  description: Valor por defecto null o vacío. Descripción asociada a la factura.

•  discount: Valor decimal. Acepta valores en formato 10, 10.01, 99.99. Indica el descuento aplicado. El valor por defecto es 0 y es obligatorio.

•  discount_per_item: Acepta dos valores YES o NO. Por defecto es NO y es obligatorio.

•  discount_type: Acepta dos valores fixed o percentage. Por defecto es fixed y es obligatorio.

•  discount_val: Valor de tipo biginteger. Indica el monto del descuento aplicado. Obligatorio. El valor por defecto es 0. Para este campo solo se aceptan números enteros. Los dos últimos dígitos representan los decimales.

•  Ejemplo: 99.99 se debe enviar 9999.

•  Ejemplo: 10.13 se debe enviar 1013.

•  due_amount: Valor de tipo biginteger. Es el total de la factura. Obligatorio. El valor por defecto es 0. Para este campo solo se aceptan números enteros. Los dos últimos dígitos representan los decimales.

•  Ejemplo: 99.99 se debe enviar 9999.

•  Ejemplo: 10.13 se debe enviar 1013.

•  due_date: Campo de tipo fecha en formato Y-m-d. Es obligatorio. Indica la fecha de vencimiento de la factura.

•  Ejemplo: El formato 2024-11-08 corresponde a Y-m-d, donde:

•  Y: Año completo (2024).

•  m: Mes con dos dígitos (11).

•  d: Día con dos dígitos (08).

•  hold_invoice_id: Valor por defecto null. Aquí se debe enviar el ID de la orden (Hold Invoice). Obligatorio.

•  invoice_date: Campo de tipo fecha en formato Y-m-d. Es obligatorio. Indica la fecha de creación/inicio de la factura.

•  Ejemplo: El formato 2024-11-08 corresponde a Y-m-d, donde:

•  Y: Año completo (2024).

•  m: Mes con dos dígitos (11).

•  d: Día con dos dígitos (08).

•  invoice_number: Indica el número de identificación de la factura. Es obligatorio. Se obtiene del endpoint.

•  invoice_pbx_modify: Recibe valores 0 y 1. Usado para la configuración de factura PBX. En POS, enviar 0.

•  invoice_template_id: Recibe el valor de 1. Obligatorio.

•  is_hold_invoice: Recibe valores true o false. Obligatorio. Enviar true si la factura viene de una orden, caso contrario false.

•  is_invoice_pos: Recibe valores 0 y 1. Si la factura es para POS, enviar 1, caso contrario 0.

•  is_pdf_pos: Recibe valores true o false. Si la factura es para POS, enviar true, caso contrario false.

•  items: Campo de tipo array que lista los ítems. En este array debe haber al menos un registro. La estructura de cada registro es el objeto completo de ítems.

•  not_charge_automatically: Valor booleano (true o false). Por defecto false. Cuando se envía true, indica que la factura no se puede cobrar de forma automática, solo manualmente.

•  notes: Valor por defecto null o vacío. En este campo se envían las notas asociadas a la factura.

•  package_bool: Acepta valores true o false. Indica si está asociado a un servicio normal. Para POS, enviar false.

•  packages: Tipo array. Asocia diferentes servicios a una factura. Para POS, enviar null o [].

•  print_pdf: Recibe valores true o false. Indica si la factura dispara el cuadro de impresión automáticamente.

•  save_as_draft: Recibe valores true o false. Indica si la factura se guarda como borrador de forma permanente.

•  send_email: Valor booleano (true o false). Indica si se envía por correo de forma automática al cliente cuando se crea la factura.

•  store_id: Por defecto null. En este campo se envía el ID de la tienda asociada a la orden o pedido.

•  sub_total: Valor de tipo biginteger. Es el subtotal o la sumatoria de los ítems, sin impuestos ni descuentos de la factura. Obligatorio. El valor por defecto es 0. Para este campo solo se aceptan números enteros. Los dos últimos dígitos representan los decimales.

•  Ejemplo: 99.99 se debe enviar 9999.

•  Ejemplo: 10.13 se debe enviar 1013.

•  tables_selected: Campo de tipo array. Valor por defecto []. Envía el registro de las mesas. Por cada registro se debe enviar:

•  table_id: ID de la mesa.

•  quantity: Número de ocupantes, tipo entero.

•  tax: Valor de tipo biginteger. Es el total de la sumatoria de los impuestos asociados a la factura. Obligatorio. El valor por defecto es 0. Para este campo solo se aceptan números enteros. Los dos últimos dígitos representan los decimales.

•  Ejemplo: 99.99 se debe enviar 9999.

•  Ejemplo: 10.13 se debe enviar 1013.

•  taxes: Array que trae los impuestos asociados a la factura. Valor por defecto []. Cada registro contiene el objeto de impuestos.

•  tip: Valor decimal. Acepta valores en formato 10, 10.01, 99.99. Indica la propina aplicada. El valor por defecto es 0 y es obligatorio.

•  tip_type: Acepta dos valores fixed o percentage. Por defecto es fixed y es obligatorio.

•  tip_val: Valor de tipo biginteger. Indica el monto de la propina. Obligatorio. El valor por defecto es 0. Para este campo solo se aceptan números enteros. Los dos últimos dígitos representan los decimales.

•  Ejemplo: 99.99 se debe enviar 9999.

•  Ejemplo: 10.13 se debe enviar 1013.

•  total: Valor de tipo biginteger. Indica el monto total de la factura (subtotal más impuestos, más propinas, menos descuentos). Obligatorio. El valor por defecto es 0. Para este campo solo se aceptan números enteros. Los dos últimos dígitos representan los decimales.

•  Ejemplo: 99.99 se debe enviar 9999.

•  Ejemplo: 10.13 se debe enviar 1013.

•  user_id: Indica el número de ID del cliente asociado a la factura.

Payload:
avalara_bool: false
banType: true
cash_register_id: 6
contact: {name: "Kirkendall Dwyer LLP II", last_name: "123", email: "info@careonecomm.com", phone: "4699989608",…}
email: "info@careonecomm.com"
identification: "11223"
last_name: "123"
name: "Kirkendall Dwyer LLP II"
phone: "4699989608"
second_phone: "123344"
description: ""
discount: "10"
discount_per_item: "NO"
discount_type: "fixed"
discount_val: 1000
due_amount: 2613694.68
due_date: "2024-11-08"
hold_invoice_id: null
invoice_date: "2024-11-01"
invoice_number: "INV-14043919"
invoice_pbx_modify: 0
invoice_template_id: 1
is_hold_invoice: false
is_invoice_pos: 1
is_pdf_pos: true
items: [{id: 161, name: "Item test", description: null, price: 2222, allow_taxes: 0, no_taxable: 0,…},…]
not_charge_automatically: false
notes: "<p>Nota 1Nota 1Nota 1Nota 1Nota 1Nota 1</p>"
package_bool: false
packages: []
print_pdf: false
save_as_draft: false
send_email: false
store_id: 11
sub_total: 2466278
tables_selected: []
tax: 147916.68
taxes: [{name: "tax", amount: 123263.9, compound_tax: 0, percent: 5, tax_type_id: 29},…]
tip: "5"
tip_type: "fixed"
tip_val: 500
total: 2613694.68
user_id: 23

 

Ejemplo de Solicitud:

POST /api/v1/invoices
Host: yourapi.com
Authorization: Bearer <token>

Respuesta:
{
    "invoice": {
        "id": 60588,
        "package_bool": 0,
        "customer_packages_id": null,
        "pbx_service_id": null,
        "invoice_date": "2024-11-01T05:00:00.000000Z",
        "due_date": "2024-11-08",
        "invoice_number": "INV-14043919",
        "reference_number": null,
        "status": "SENT",
        "paid_status": "UNPAID",
        "save_as_draft": 0,
        "not_charge_automatically": 0,
        "tax_per_item": "NO ",
        "discount_per_item": "NO",
        "notes": "<p>Nota 1Nota 1Nota 1Nota 1Nota 1Nota 1<\/p>",
        "discount_type": "fixed",
        "discount": 10,
        "discount_val": 1000,
        "sub_total": 2466278,
        "total": 2613695,
        "late_fee_amount": 0,
        "late_fee_taxes": 0,
        "pbx_service_price": 0,
        "tax": 147917,
        "due_amount": 2613695,
        "sent": 0,
        "viewed": 0,
        "unique_hash": "6724d1aa34f020.19151200",
        "user_id": 23,
        "company_id": 1,
        "created_at": "2024-11-01T13:03:38.000000Z",
        "updated_at": "2024-11-01T13:03:38.000000Z",
        "creator_id": 1,
        "template_name": null,
        "deleted_at": null,
        "pbx_total_items": 0,
        "pbx_total_extension": 0,
        "pbx_total_did": 0,
        "pbx_total_aditional_charges": 0,
        "pbx_total_cdr": 0,
        "avalara_total_tax": null,
        "inv_avalara_bool": 0,
        "avalara_invm": null,
        "pbxservice_date_prev": null,
        "pbxservice_date_renewal": null,
        "end_period_services": null,
        "attempts": 0,
        "autodebit_notices_check": 0,
        "sended_credentials": 0,
        "invoice_pbx_modify": 0,
        "invoice_template_id": 1,
        "invoiceprorate": 0,
        "prepaid_amount": "0.00000",
        "tax_prepaid_amount": "0.00000",
        "pbx_total_apprate": 0,
        "retention_total": 0,
        "retention": "NO",
        "pbx_packprice": 0,
        "noeditable": 0,
        "addresses_id": null,
        "pbx_extension_price": 0,
        "count_extension": 0,
        "count_did": 0,
        "edited_at": null,
        "is_edited": 0,
        "is_pdf_pos": 1,
        "is_invoice_pos": 1,
        "service_manual": 0,
        "formattedInvoiceDate": "2024\/11\/01",
        "formattedCreatedAt": "2024\/11\/01",
        "formattedDueDate": "2024\/11\/08",
        "formattedPrevDate": "",
        "formattedRenewalDate": "",
        "formattedEndPeriodServices": null,
        "formattedFullPeriodService": "",
        "invoicePdfUrl": "https:\/\/cbdev.corebill.co\/invoices\/pdf\/6724d1aa34f020.19151200",
        "is_recuperable": 0,
        "items": [
            {
                "id": 134060,
                "name": "Item test",
                "description": null,
                "discount_type": "fixed",
                "price": 2222,
                "quantity": 1,
                "unit_name": null,
                "discount": 0,
                "discount_val": 0,
                "tax": 0,
                "total": 2222,
                "invoice_id": 60588,
                "item_id": 161,
                "retention_id": null,
                "retention_concept": null,
                "retention_percentage": null,
                "retention_amount": 0,
                "company_id": 1,
                "created_at": "2024-11-01T13:03:38.000000Z",
                "updated_at": "2024-11-01T13:03:38.000000Z"
            },
            {
                "id": 134061,
                "name": "Paquete demo 2",
                "description": null,
                "discount_type": "fixed",
                "price": 2123123,
                "quantity": 1,
                "unit_name": null,
                "discount": 0,
                "discount_val": 0,
                "tax": 0,
                "total": 2123123,
                "invoice_id": 60588,
                "item_id": 157,
                "retention_id": null,
                "retention_concept": null,
                "retention_percentage": null,
                "retention_amount": 0,
                "company_id": 1,
                "created_at": "2024-11-01T13:03:38.000000Z",
                "updated_at": "2024-11-01T13:03:38.000000Z"
            },
            {
                "id": 134062,
                "name": "test22",
                "description": null,
                "discount_type": "fixed",
                "price": 123123,
                "quantity": 1,
                "unit_name": null,
                "discount": 0,
                "discount_val": 0,
                "tax": 0,
                "total": 123123,
                "invoice_id": 60588,
                "item_id": 154,
                "retention_id": null,
                "retention_concept": null,
                "retention_percentage": null,
                "retention_amount": 0,
                "company_id": 1,
                "created_at": "2024-11-01T13:03:38.000000Z",
                "updated_at": "2024-11-01T13:03:38.000000Z"
            },
            {
                "id": 134063,
                "name": "escena",
                "description": null,
                "discount_type": "fixed",
                "price": 222,
                "quantity": 1,
                "unit_name": null,
                "discount": 0,
                "discount_val": 0,
                "tax": 0,
                "total": 222,
                "invoice_id": 60588,
                "item_id": 153,
                "retention_id": null,
                "retention_concept": null,
                "retention_percentage": null,
                "retention_amount": 0,
                "company_id": 1,
                "created_at": "2024-11-01T13:03:38.000000Z",
                "updated_at": "2024-11-01T13:03:38.000000Z"
            },
            {
                "id": 134064,
                "name": "Item Test New Category",
                "description": null,
                "discount_type": "fixed",
                "price": 123,
                "quantity": 1,
                "unit_name": null,
                "discount": 0,
                "discount_val": 0,
                "tax": 0,
                "total": 123,
                "invoice_id": 60588,
                "item_id": 143,
                "retention_id": null,
                "retention_concept": null,
                "retention_percentage": null,
                "retention_amount": 0,
                "company_id": 1,
                "created_at": "2024-11-01T13:03:38.000000Z",
                "updated_at": "2024-11-01T13:03:38.000000Z"
            },
            {
                "id": 134065,
                "name": "Item Pattern 6",
                "description": null,
                "discount_type": "fixed",
                "price": 1000,
                "quantity": 1,
                "unit_name": null,
                "discount": 0,
                "discount_val": 0,
                "tax": 0,
                "total": 1000,
                "invoice_id": 60588,
                "item_id": 131,
                "retention_id": null,
                "retention_concept": null,
                "retention_percentage": null,
                "retention_amount": 0,
                "company_id": 1,
                "created_at": "2024-11-01T13:03:38.000000Z",
                "updated_at": "2024-11-01T13:03:38.000000Z"
            },
            {
                "id": 134066,
                "name": "necron",
                "description": null,
                "discount_type": "fixed",
                "price": 2222,
                "quantity": 1,
                "unit_name": null,
                "discount": 0,
                "discount_val": 0,
                "tax": 0,
                "total": 2222,
                "invoice_id": 60588,
                "item_id": 151,
                "retention_id": null,
                "retention_concept": null,
                "retention_percentage": null,
                "retention_amount": 0,
                "company_id": 1,
                "created_at": "2024-11-01T13:03:38.000000Z",
                "updated_at": "2024-11-01T13:03:38.000000Z"
            },
            {
                "id": 134067,
                "name": "Aires soy 2",
                "description": null,
                "discount_type": "fixed",
                "price": 102222,
                "quantity": 1,
                "unit_name": null,
                "discount": 0,
                "discount_val": 0,
                "tax": 0,
                "total": 102222,
                "invoice_id": 60588,
                "item_id": 156,
                "retention_id": null,
                "retention_concept": null,
                "retention_percentage": null,
                "retention_amount": 0,
                "company_id": 1,
                "created_at": "2024-11-01T13:03:38.000000Z",
                "updated_at": "2024-11-01T13:03:38.000000Z"
            },
            {
                "id": 134068,
                "name": "Aire soy",
                "description": null,
                "discount_type": "fixed",
                "price": 102022,
                "quantity": 1,
                "unit_name": null,
                "discount": 0,
                "discount_val": 0,
                "tax": 0,
                "total": 102022,
                "invoice_id": 60588,
                "item_id": 155,
                "retention_id": null,
                "retention_concept": null,
                "retention_percentage": null,
                "retention_amount": 0,
                "company_id": 1,
                "created_at": "2024-11-01T13:03:38.000000Z",
                "updated_at": "2024-11-01T13:03:38.000000Z"
            },
            {
                "id": 134069,
                "name": "Articulo item 2",
                "description": null,
                "discount_type": "fixed",
                "price": 9999,
                "quantity": 1,
                "unit_name": null,
                "discount": 0,
                "discount_val": 0,
                "tax": 0,
                "total": 9999,
                "invoice_id": 60588,
                "item_id": 149,
                "retention_id": null,
                "retention_concept": null,
                "retention_percentage": null,
                "retention_amount": 0,
                "company_id": 1,
                "created_at": "2024-11-01T13:03:38.000000Z",
                "updated_at": "2024-11-01T13:03:38.000000Z"
            }
        ],
        "user": {
            "id": 23,
            "first_name": null,
            "last_name": null,
            "name": "Kirkendall Dwyer LLP II",
            "email": "info@careonecomm.com",
            "phone": "4699989608",
            "customer_username": null,
            "password_encrypted": "eyJpdiI6Ik4zY1NsTU5HZHFqR2lsM0I4OTc5TFE9PSIsInZhbHVlIjoiTkVEemFwa0lucUtRRGxCTmVML2lKUT09IiwibWFjIjoiZjlmZGNhZjM2NTM1ZmZhMzVkMDMwZDQyOWU3NDg3ZjFjNTQzNTQ3NjBkM2RkNmFjOTZjYTBmZDkwNDNhOThkMyIsInRhZyI6IiJ9",
            "security_pin": "7414",
            "role": "customer",
            "role2": null,
            "authentication": 1,
            "username_status": 0,
            "facebook_id": null,
            "google_id": null,
            "github_id": null,
            "contact_name": "Andrew Kirkendall",
            "company_name": null,
            "website": null,
            "enable_portal": null,
            "currency_id": 1,
            "company_id": 1,
            "company_orf": null,
            "company_orf_type": null,
            "customer_type": "B",
            "avalara_bool": 1,
            "avalara_type": "1",
            "bscl": null,
            "svcl": null,
            "fclt": null,
            "reg": null,
            "avalara_location_id": 19,
            "prepaid_option": "1",
            "auto_debit": "0",
            "email_low_balance_notification": 50,
            "auto_replenish_amount": 75,
            "negative_balance": 0,
            "language": "en",
            "timezone": "America\/Chicago",
            "auto_suspension": 0,
            "created_at": "2022-05-20T16:49:59.000000Z",
            "updated_at": "2024-09-10T22:03:26.000000Z",
            "creator_id": 1,
            "deleted_at": null,
            "status_customer": "A",
            "customcode": "POP-000023",
            "balance": 3.4980008745004e-8,
            "add_shipping_addres": 0,
            "status_payment": "prepaid",
            "minimun_balance": "75.00000",
            "sendedcredentials": 1,
            "sale_type": "Retail",
            "frch": null,
            "lfln": 0,
            "type_vat_regime": 1,
            "great_contributor": 0,
            "self_retaining": 0,
            "vat_withholding_agent": 0,
            "simple_tax_regime": 0,
            "not_applicable_others": 0,
            "firebase_code": "d6ekuqp9RdW0UkITZsiuC2:APA91bGnRjeH0_42d1RNNz3hd1UT4XSKndeph2U3fOV0QEpcMUym-fP__xkWUI-IO4t2wCxlkge4ywXndIcdWffbn265NX07-nNOcpck7BNjc4s4ZviNoWP85z9vAjk2XZdUIceYoS9U",
            "pbx_notification": 0,
            "email_estimates": 0,
            "email_invoices": 0,
            "email_payments": 0,
            "email_services": 0,
            "email_pbx_services": 0,
            "email_tickets": 0,
            "email_expenses": 0,
            "avatar": 0,
            "incorporated": 1,
            "lead_id": null,
            "verified": 0,
            "formattedCreatedAt": "2022\/05\/20",
            "formattedMakePayment": "YES",
            "formattedAddCredit": "YES",
            "formattedNameCompleted": "Kirkendall Dwyer LLP II - Andrew Kirkendall",
            "currency": {
                "id": 1,
                "name": "US Dollar",
                "code": "USD",
                "symbol": "$",
                "precision": 2,
                "thousand_separator": ",",
                "decimal_separator": ".",
                "swap_currency_symbol": 0,
                "created_at": "2022-03-15T00:02:03.000000Z",
                "updated_at": "2022-03-15T00:02:03.000000Z"
            },
            "media": []
        },
        "invoice_template": {
            "id": 1,
            "name": "Template 1",
            "view": "invoice1",
            "path": "https:\/\/cbdev.corebill.co\/assets\/img\/PDF\/Template1.png",
            "created_at": "2021-05-11T05:17:22.000000Z",
            "updated_at": "2021-05-11T05:17:22.000000Z"
        },
        "taxes": [
            {
                "id": 103549,
                "tax_type_id": 29,
                "invoice_id": 60588,
                "estimate_id": null,
                "invoice_item_id": null,
                "estimate_item_id": null,
                "item_id": null,
                "company_id": 1,
                "name": "tax",
                "amount": 123264,
                "percent": 5,
                "compound_tax": 0,
                "created_at": "2024-11-01T13:03:38.000000Z",
                "updated_at": "2024-11-01T13:03:38.000000Z",
                "pbx_package_id": null,
                "pbx_package_item_id": null,
                "pbx_service_item_id": null,
                "package_id": null,
                "package_item_id": null
            },
            {
                "id": 103550,
                "tax_type_id": 27,
                "invoice_id": 60588,
                "estimate_id": null,
                "invoice_item_id": null,
                "estimate_item_id": null,
                "item_id": null,
                "company_id": 1,
                "name": "prueba test",
                "amount": 24653,
                "percent": 1,
                "compound_tax": 0,
                "created_at": "2024-11-01T13:03:38.000000Z",
                "updated_at": "2024-11-01T13:03:38.000000Z",
                "pbx_package_id": null,
                "pbx_package_item_id": null,
                "pbx_service_item_id": null,
                "package_id": null,
                "package_item_id": null
            }
        ]
    }
}
